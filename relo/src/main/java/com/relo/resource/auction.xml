<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.relo.auction.AuctionDao">

<resultMap id="productMap" type="com.relo.product.ProductVo" autoMapping="true">
	<id property="pNum" column="p_num"/>
	<association property="stockVo" javaType="com.relo.stock.StockVo" autoMapping="true">
	    <id property="sNum" column="s_num"/> 
		<result column="sName" property="s_name"/>
	</association>
	<collection property="a"  javaType="com.relo.auction.AuctionVo" autoMapping="true" >
		<id property="aNum" column="a_num" /> 
		<result column="id" property="id"/>
		<result column="aPrice" property="a_price"/>
		<result column="pNum" property="p_num"/>
	</collection>
</resultMap>

<select id="selectByPStatus" resultType="productMap">
select p.p_num, a.a_num , a.id, a.a_price, s.s_name  , s.s_num
from auction a, product p, stock s  
where p.p_status = 6  and a.a_price 
in (  
  select max(a_price)   
  from auction   
  where p_num=p.p_num)  
and a.p_num = p.p_num  
and p.s_num = s.s_num
</select>
</mapper>